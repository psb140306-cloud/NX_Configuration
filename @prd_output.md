# PRD: NX Configuration Launcher

## Problem Statement

NX 프로그램 사용 시 다음과 같은 불편함이 존재한다:
- 작업 중 메시지/메일 등 네트워크로 인한 방해 요소 발생
- 라이센스 서버 포트 변경 시 환경변수를 직접 수정해야 함
- 언어 변경 시 환경변수를 직접 수정해야 함
- NX 종료 후에도 관련 프로세스가 남아 시스템 리소스를 점유함
- 여러 NX 버전이 설치된 경우 원하는 버전 실행이 번거로움

**이 프로그램은 NX 실행 전 설정을 간편하게 관리하고, 종료 후 잔여 프로세스를 정리하는 런처 프로그램이다.**

---

## Functional Requirements

### FR-1. NX 버전 자동 감지 및 선택 실행

| 항목 | 내용 |
|------|------|
| 설명 | 시스템에 설치된 NX 버전을 자동 감지하여 목록으로 표시하고, 사용자가 선택한 버전을 실행한다 |
| 감지 방법 | 레지스트리 또는 기본 설치 경로(`C:\Program Files\Siemens\`) 스캔 |
| 표시 정보 | NX 버전명, 설치 경로 |
| 실행 파일 | `ugraf.exe` |

### FR-2. 네트워크 차단 옵션

| 항목 | 내용 |
|------|------|
| 설명 | NX 실행 시 관련 프로세스들의 네트워크 통신을 Windows 방화벽 규칙으로 차단한다 |
| 차단 대상 프로세스 | `ugraf.exe`, `lmgrd.exe`, `ugslmd.exe`, `splm*.exe` |
| 동작 방식 | 체크박스 ON → NX 실행 전 방화벽 Outbound 규칙 추가 |
| 해제 방식 | 체크박스 OFF 또는 프로그램 종료 시 방화벽 규칙 제거 |
| 권한 | 관리자 권한 필요 (UAC 요청) |

### FR-3. 라이센스 서버 포트 변경

| 항목 | 내용 |
|------|------|
| 설명 | 라이센스 서버 포트를 변경한다 |
| 환경변수 | `SPLM_LICENSE_SERVER` |
| 형식 | `포트@서버주소` (예: `28000@license-server`) |
| UI | 드롭다운 또는 직접 입력으로 포트 선택 (28000, 27800, 29000 등) |
| 서버주소 | 기존 환경변수에서 서버주소 부분을 파싱하여 유지 |

### FR-4. 언어 변경 옵션

| 항목 | 내용 |
|------|------|
| 설명 | NX 실행 언어를 변경한다 |
| 환경변수 | `UGII_LANG` |
| 지원 언어 | English (`english`), Korean (`korean`) |
| UI | 라디오 버튼 또는 드롭다운 |

### FR-5. 프로세스 모니터링 및 종료

| 항목 | 내용 |
|------|------|
| 설명 | NX 관련 프로세스 실행 상태를 표시하고, 수동으로 종료할 수 있다 |
| 대상 프로세스 | `ugraf.exe`, `lmgrd.exe`, `ugslmd.exe`, `splm*.exe`, `ugs_router.exe`, `nxsession.exe`, `nxtask.exe`, `javaw.exe`, `java.exe`, `ugtopv.exe` |
| 상태 표시 | 프로그램 실행 시 각 프로세스의 실행 여부를 아이콘 또는 텍스트로 표시 |
| 종료 기능 | "프로세스 정리" 버튼 클릭 → 확인 팝업 → 실행 중인 관련 프로세스 강제 종료 |
| 새로고침 | 프로세스 상태를 수동으로 새로고침하는 버튼 제공 |

### FR-6. 설정 저장 및 불러오기

| 항목 | 내용 |
|------|------|
| 설명 | 사용자가 변경한 설정을 저장하여 다음 실행 시 유지한다 |
| 저장 항목 | 선택된 NX 버전, 네트워크 차단 여부, 라이센스 포트, 언어 설정 |
| 저장 위치 | 프로그램 실행 폴더 내 `config.json` 또는 사용자 AppData 폴더 |
| 저장 형식 | JSON |

---

## Non-Goals (범위 외)

- NX 프로그램 자체의 내부 설정 변경
- 라이센스 서버 주소(IP/호스트명) 변경 기능
- 시스템 전체 네트워크 차단 (비행기 모드)
- NX 설치/제거 기능
- 3개 이상의 언어 지원
- NX 자동 종료 감지 및 자동 프로세스 정리

---

## Design Considerations

### UI 레이아웃 (단일 화면)

```
┌─────────────────────────────────────────────────────────────┐
│  NX Configuration Launcher                           [─][□][×]│
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─ NX 버전 ─────────────────────────────────────────────┐  │
│  │  [▼ NX 2306 - C:\Program Files\Siemens\NX2306\NXBIN\] │  │
│  │  설치 경로: C:\Program Files\Siemens\NX2306\          │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌─ 실행 옵션 ───────────────────────────────────────────┐  │
│  │  [✓] 네트워크 차단 (방화벽)                           │  │
│  │                                                       │  │
│  │  라이센스 포트: [▼ 28000 ] @ license-server           │  │
│  │                                                       │  │
│  │  언어: (●) English  ( ) Korean                        │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌─ 프로세스 상태 ───────────────────────────────────────┐  │
│  │  ● ugraf.exe      ○ lmgrd.exe       ○ ugslmd.exe     │  │
│  │  ○ ugs_router.exe ○ nxsession.exe   ○ javaw.exe      │  │
│  │                                      [🔄 새로고침]    │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│        [    NX 실행    ]     [  프로세스 정리  ]            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### UI 상세

| 요소 | 설명 |
|------|------|
| 프로세스 상태 | ● 실행 중 (초록), ○ 미실행 (회색) |
| NX 실행 버튼 | 선택된 버전과 설정으로 NX 실행 |
| 프로세스 정리 버튼 | 확인 팝업 후 관련 프로세스 강제 종료 |
| 새로고침 버튼 | 프로세스 상태 갱신 |

### 기술 스택

| 항목 | 선택 | 이유 |
|------|------|------|
| 언어 | **C# (.NET 8)** | Windows 네이티브 기능(방화벽, 프로세스, 레지스트리) 접근 용이 |
| UI 프레임워크 | **WPF** | Windows 전용 프로그램에 적합, 모던 UI 구현 가능 |

### 배포 방식

#### 개발/테스트 단계: Self-Contained 단일 EXE

| 항목 | 내용 |
|------|------|
| 방식 | .NET Self-Contained 단일 실행 파일 |
| 장점 | 설치 없이 즉시 실행, .NET 런타임 설치 불필요 |
| 단점 | 파일 크기 약 60-150MB |
| 빌드 명령 | `dotnet publish -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true` |

#### 정식 배포: Inno Setup 인스톨러

| 항목 | 내용 |
|------|------|
| 방식 | Inno Setup을 사용한 설치 프로그램 생성 |
| 장점 | 시작 메뉴/바탕화면 바로가기 생성, 프로그램 추가/제거 등록, 커스터마이징 자유로움 |
| 설치 파일 크기 | 약 30-50MB (압축 시) |
| 포함 내용 | 실행 파일, 설정 파일 템플릿, 관리자 권한 요청 매니페스트 |

#### 인스톨러 기능 명세

| 기능 | 설명 |
|------|------|
| 설치 경로 선택 | 기본값: `C:\Program Files\NX Configuration Launcher\` |
| 바로가기 생성 | 바탕화면, 시작 메뉴 (선택 가능) |
| 관리자 권한 | 설치 시 UAC 요청, 실행 파일에 관리자 권한 매니페스트 포함 |
| 제거 기능 | 프로그램 추가/제거에서 완전 삭제 가능 |
| 설정 파일 처리 | 제거 시 사용자 설정 파일(`config.json`) 유지 여부 선택 |

### 권한 요구사항

- **관리자 권한 필요**: 방화벽 규칙 추가/제거, 환경변수 수정 시
- 프로그램 실행 시 UAC 권한 상승 요청

### 에러 처리

| 상황 | 처리 |
|------|------|
| NX 설치 미감지 | "NX가 설치되어 있지 않습니다" 메시지 표시 |
| 관리자 권한 없음 | "관리자 권한이 필요합니다" 메시지 후 재실행 안내 |
| 프로세스 종료 실패 | 실패한 프로세스명 표시 |

---

## 참고: 환경변수 정리

| 환경변수 | 용도 | 형식 예시 |
|----------|------|-----------|
| `SPLM_LICENSE_SERVER` | 라이센스 서버 | `28000@license-server` |
| `UGII_LANG` | NX 언어 설정 | `english`, `korean` |
